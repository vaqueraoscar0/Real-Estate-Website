import * as React from 'react';
import {AppBar, Box, Button, Menu, MenuItem, Snackbar, Toolbar, Typography} from "@mui/material";
import {useNavigate} from "react-router-dom";
import {useContext, useEffect, useState} from "react";
import DispatchContext from "../Context/DispatchContext";
import ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown';
import {ArrowDropUp} from "@mui/icons-material";
import StateContext from "../Context/StateContext";
import axios from "axios";

const Header = () => {
    const navigate = useNavigate()
    const GlobalState = useContext(StateContext)
    const GlobalDispatch = useContext(DispatchContext)

    const [isArrow, setIsArrow] = useState(false)

    const [anchorEl, setAnchorEl] = React.useState(null);
    const open = Boolean(anchorEl);
    const handleClick = (event) => {
        setAnchorEl(event.currentTarget);
        setIsArrow(!isArrow)
    };
    const handleClose = () => {
        setAnchorEl(null);
    };

    const [openSnack, setOpenSnack] = useState(false)


    async function handleLogout() {
        setAnchorEl(null);
        handleClose()
        const confirmLogout = window.confirm('Are you sure you want to Logout?')
        if(confirmLogout){
            try {
                await axios.post(
                    'https://listingbuddy-d88c1ed5b70e.herokuapp.com/api-auth-djoser/token/logout/',
                    GlobalState.userToken,
                    {headers: { Authorization: "Token ".concat(GlobalState.userToken)}
                    })

                GlobalDispatch({type: "logout"})
                await setOpenSnack(true)
            }catch (e){
                console.log(e.response)
            }
        }
    }

    useEffect(() => {
        if(openSnack){
            setTimeout(() => {
                navigate('/')
                setOpenSnack(false)
            }, 1500 )
        }
    }, [openSnack])

    function handleProfile() {
        navigate('/profile')
        handleClose()
    }

    return (
        <>
            <Box sx={{flexGrow: 1}}>
                <AppBar position="static">
                    <Toolbar style={{justifyContent: 'space-between', backgroundColor: 'white', padding: '10px'}}>
                        <Button onClick={() => navigate('/')}>
                            {/*<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" style={{marginBottom: '15px'}}><path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z"/></svg>*/}
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 1024 1024" id="building"><path d="M612.161,897.758c-15.585,0-31.17,0-46.755,0c-37.603,0-75.206,0-112.808,0c-45.341,0-90.682,0-136.023,0c-39.333,0-78.665,0-117.998,0c-12.906,0-25.812,0-38.719,0c-6.086,0-12.299-0.361-18.377,0c-0.265,0.016-0.536,0-0.802,0c5,5,10,10,15,15c0-6.595,0-13.19,0-19.786c0-17.95,0-35.9,0-53.85c0-26.552,0-53.104,0-79.656c0-32.4,0-64.801,0-97.201c0-35.663,0-71.325,0-106.988c0-35.834,0-71.668,0-107.502c0-33.411,0-66.821,0-100.232c0-28.234,0-56.469,0-84.703c0-20.305,0-40.61,0-60.915c0-9.593,0.393-19.28,0-28.867c-0.017-0.413,0-0.829,0-1.243c-5,5-10,10-15,15c15.585,0,31.17,0,46.755,0c37.603,0,75.206,0,112.808,0c45.341,0,90.682,0,136.023,0c39.333,0,78.665,0,117.998,0c12.906,0,25.812,0,38.719,0c6.086,0,12.299,0.361,18.377,0c0.265-0.016,0.536,0,0.802,0c-5-5-10-10-15-15c0,6.595,0,13.191,0,19.786c0,17.95,0,35.9,0,53.85c0,26.552,0,53.104,0,79.656c0,32.4,0,64.801,0,97.201c0,35.663,0,71.325,0,106.988c0,35.834,0,71.668,0,107.502c0,33.411,0,66.821,0,100.232c0,28.234,0,56.469,0,84.703c0,20.305,0,40.61,0,60.915c0,9.614-0.212,19.255,0,28.867c0.009,0.414,0,0.829,0,1.243c0,7.846,6.899,15.363,15,15c8.127-0.364,15-6.591,15-15c0-6.595,0-13.19,0-19.786c0-17.95,0-35.9,0-53.85c0-26.552,0-53.104,0-79.656c0-32.4,0-64.801,0-97.201c0-35.663,0-71.325,0-106.988c0-35.834,0-71.668,0-107.502c0-33.411,0-66.821,0-100.232c0-28.234,0-56.469,0-84.703c0-20.305,0-40.61,0-60.915c0-9.614,0.212-19.255,0-28.867c-0.009-0.414,0-0.829,0-1.243c0-8.109-6.872-15-15-15c-15.585,0-31.17,0-46.755,0c-37.603,0-75.206,0-112.808,0c-45.341,0-90.682,0-136.023,0c-39.333,0-78.665,0-117.998,0c-18.997,0-38.105-0.6-57.096,0c-0.267,0.008-0.535,0-0.802,0c-8.109,0-15,6.872-15,15c0,6.595,0,13.191,0,19.786c0,17.95,0,35.9,0,53.85c0,26.552,0,53.104,0,79.656c0,32.4,0,64.801,0,97.201c0,35.663,0,71.325,0,106.988c0,35.834,0,71.668,0,107.502c0,33.411,0,66.821,0,100.232c0,28.234,0,56.469,0,84.703c0,20.305,0,40.61,0,60.915c0,9.614-0.212,19.255,0,28.867c0.009,0.414,0,0.829,0,1.243c0,8.109,6.872,15,15,15c15.585,0,31.17,0,46.755,0c37.603,0,75.206,0,112.808,0c45.341,0,90.682,0,136.023,0c39.333,0,78.665,0,117.998,0c18.997,0,38.105,0.6,57.096,0c0.267-0.008,0.535,0,0.802,0c7.846,0,15.363-6.899,15-15C626.797,904.631,620.57,897.758,612.161,897.758z"></path><path d="M643.624 95.824c-17.807 0-35.614 0-53.421 0-42.413 0-84.825 0-127.238 0-51.611 0-103.221 0-154.832 0-44.335 0-88.67 0-133.005 0-21.644 0-43.391-.618-65.028 0-.295.008-.591 0-.886 0-8.109 0-15 6.872-15 15 0 20.331 0 40.662 0 60.993 0 8.109 6.872 15 15 15 17.807 0 35.614 0 53.421 0 42.413 0 84.825 0 127.238 0 51.611 0 103.221 0 154.832 0 44.335 0 88.67 0 133.005 0 21.644 0 43.391.618 65.028 0 .295-.008.591 0 .886 0 8.109 0 15-6.872 15-15 0-20.331 0-40.662 0-60.993C658.624 102.977 651.725 95.461 643.624 95.824c-8.127.364-15 6.591-15 15 0 20.331 0 40.662 0 60.993 5-5 10-10 15-15-17.807 0-35.614 0-53.421 0-42.413 0-84.825 0-127.238 0-51.611 0-103.221 0-154.832 0-44.335 0-88.67 0-133.005 0-14.713 0-29.426 0-44.139 0-6.928 0-13.969-.365-20.889 0-.293.015-.592 0-.886 0 5 5 10 10 15 15 0-20.331 0-40.662 0-60.993-5 5-10 10-15 15 17.807 0 35.614 0 53.421 0 42.413 0 84.825 0 127.238 0 51.611 0 103.221 0 154.832 0 44.335 0 88.67 0 133.005 0 21.644 0 43.391.618 65.028 0 .295-.008.591 0 .886 0 7.846 0 15.363-6.899 15-15C658.26 102.697 652.034 95.824 643.624 95.824zM900.915 484.671c0 20.33 0 40.66 0 60.99 5-5 10-10 15-15-34.267 0-68.534 0-102.802 0-54.584 0-109.167 0-163.751 0-12.482 0-24.965 0-37.447 0 5 5 10 10 15 15 0-20.33 0-40.66 0-60.99-5 5-10 10-15 15 34.267 0 68.534 0 102.802 0 54.584 0 109.167 0 163.751 0 12.482 0 24.965 0 37.447 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-34.267 0-68.534 0-102.802 0-54.584 0-109.167 0-163.751 0-12.482 0-24.965 0-37.447 0-8.109 0-15 6.872-15 15 0 20.33 0 40.66 0 60.99 0 8.109 6.872 15 15 15 34.267 0 68.534 0 102.802 0 54.584 0 109.167 0 163.751 0 12.482 0 24.965 0 37.447 0 8.109 0 15-6.872 15-15 0-20.33 0-40.66 0-60.99 0-7.846-6.899-15.363-15-15C907.788 470.035 900.915 476.262 900.915 484.671zM444.654 720.836c0 21.659 0 43.318 0 64.976 0 34.356 0 68.712 0 103.069 0 7.959 0 15.918 0 23.877 5-5 10-10 15-15-48.614 0-97.228 0-145.842 0-6.875 0-13.751 0-20.626 0 5 5 10 10 15 15 0-21.659 0-43.318 0-64.976 0-34.356 0-68.712 0-103.069 0-7.959 0-15.918 0-23.877-5 5-10 10-15 15 48.614 0 97.228 0 145.842 0 6.875 0 13.751 0 20.626 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-48.614 0-97.228 0-145.842 0-6.875 0-13.751 0-20.626 0-8.109 0-15 6.872-15 15 0 21.659 0 43.318 0 64.976 0 34.356 0 68.712 0 103.069 0 7.959 0 15.918 0 23.877 0 8.109 6.872 15 15 15 48.614 0 97.228 0 145.842 0 6.875 0 13.751 0 20.626 0 8.109 0 15-6.872 15-15 0-21.659 0-43.318 0-64.976 0-34.356 0-68.712 0-103.069 0-7.959 0-15.918 0-23.877 0-7.846-6.899-15.363-15-15C451.527 706.2 444.654 712.427 444.654 720.836z"></path><path d="M99.215 927.758c7.162 0 14.323 0 21.485 0 19.6 0 39.199 0 58.799 0 28.876 0 57.752 0 86.629 0 35.385 0 70.77 0 106.154 0 38.599 0 77.198 0 115.797 0 39.127 0 78.255 0 117.382 0 36.33 0 72.66 0 108.99 0 30.828 0 61.655 0 92.483 0 22.069 0 44.138 0 66.207 0 10.462 0 20.948.204 31.408 0 .455-.009.911 0 1.366 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-7.162 0-14.323 0-21.485 0-19.6 0-39.199 0-58.799 0-28.876 0-57.752 0-86.629 0-35.385 0-70.77 0-106.154 0-38.599 0-77.198 0-115.797 0-39.127 0-78.255 0-117.382 0-36.33 0-72.66 0-108.99 0-30.828 0-61.655 0-92.483 0-22.069 0-44.138 0-66.207 0-10.462 0-20.948-.204-31.408 0-.455.009-.911 0-1.366 0-7.846 0-15.363 6.899-15 15C84.579 920.885 90.806 927.758 99.215 927.758L99.215 927.758zM230.679 303.156c32.864 0 65.729 0 98.593 0 52.34 0 104.679 0 157.019 0 11.956 0 23.913 0 35.869 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-32.864 0-65.729 0-98.593 0-52.34 0-104.679 0-157.019 0-11.956 0-23.913 0-35.869 0-7.846 0-15.363 6.899-15 15C216.043 296.283 222.27 303.156 230.679 303.156L230.679 303.156zM230.679 615.836c32.864 0 65.729 0 98.593 0 52.34 0 104.679 0 157.019 0 11.956 0 23.913 0 35.869 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-32.864 0-65.729 0-98.593 0-52.34 0-104.679 0-157.019 0-11.956 0-23.913 0-35.869 0-7.846 0-15.363 6.899-15 15C216.043 608.963 222.27 615.836 230.679 615.836L230.679 615.836zM230.679 511.61c32.864 0 65.729 0 98.593 0 52.34 0 104.679 0 157.019 0 11.956 0 23.913 0 35.869 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-32.864 0-65.729 0-98.593 0-52.34 0-104.679 0-157.019 0-11.956 0-23.913 0-35.869 0-7.846 0-15.363 6.899-15 15C216.043 504.737 222.27 511.61 230.679 511.61L230.679 511.61zM230.679 407.383c32.864 0 65.729 0 98.593 0 52.34 0 104.679 0 157.019 0 11.956 0 23.913 0 35.869 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-32.864 0-65.729 0-98.593 0-52.34 0-104.679 0-157.019 0-11.956 0-23.913 0-35.869 0-7.846 0-15.363 6.899-15 15C216.043 400.51 222.27 407.383 230.679 407.383L230.679 407.383z"></path><path d="M361.42 720.836c0 21.659 0 43.318 0 64.976 0 34.356 0 68.712 0 103.069 0 7.959 0 15.918 0 23.877 0 7.846 6.899 15.363 15 15 8.127-.364 15-6.591 15-15 0-21.659 0-43.318 0-64.976 0-34.356 0-68.712 0-103.069 0-7.959 0-15.918 0-23.877 0-7.846-6.899-15.363-15-15C368.293 706.2 361.42 712.427 361.42 720.836L361.42 720.836zM860.915 545.661c0 12.181 0 24.363 0 36.544 0 29.084 0 58.169 0 87.253 0 35.352 0 70.704 0 106.055 0 30.564 0 61.128 0 91.692 0 14.72-.854 29.729 0 44.432.013.216 0 .436 0 .653 5-5 10-10 15-15-29.892 0-59.784 0-89.676 0-47.232 0-94.464 0-141.696 0-10.876 0-21.752 0-32.628 0 5 5 10 10 15 15 0-12.181 0-24.363 0-36.544 0-29.084 0-58.169 0-87.253 0-35.352 0-70.704 0-106.055 0-30.564 0-61.128 0-91.692 0-14.72.854-29.729 0-44.432-.013-.216 0-.436 0-.653-5 5-10 10-15 15 29.892 0 59.784 0 89.676 0 47.232 0 94.464 0 141.696 0 10.876 0 21.752 0 32.628 0 7.846 0 15.363-6.899 15-15-.364-8.127-6.591-15-15-15-29.892 0-59.784 0-89.676 0-47.232 0-94.464 0-141.696 0-10.876 0-21.752 0-32.628 0-8.109 0-15 6.872-15 15 0 12.181 0 24.363 0 36.544 0 29.084 0 58.169 0 87.253 0 35.352 0 70.704 0 106.055 0 30.564 0 61.128 0 91.692 0 14.783-.476 29.655 0 44.432.007.217 0 .435 0 .653 0 8.109 6.872 15 15 15 29.892 0 59.784 0 89.676 0 47.232 0 94.464 0 141.696 0 10.876 0 21.752 0 32.628 0 8.109 0 15-6.872 15-15 0-12.181 0-24.363 0-36.544 0-29.084 0-58.169 0-87.253 0-35.352 0-70.704 0-106.055 0-30.564 0-61.128 0-91.692 0-14.783.476-29.655 0-44.432-.007-.217 0-.435 0-.653 0-7.846-6.899-15.363-15-15C867.788 531.025 860.915 537.252 860.915 545.661z"></path><path d="M771.175,625.661c-0.029,32.357-0.059,64.713-0.088,97.07c-0.047,51.486-0.093,102.971-0.14,154.457c-0.011,11.701-0.021,23.403-0.032,35.104c5-5,10-10,15-15c-28,0-56,0-84,0c5,5,10,10,15,15c0.029-32.357,0.059-64.713,0.088-97.07c0.047-51.486,0.093-102.971,0.14-154.457c0.011-11.701,0.021-23.402,0.032-35.104c-5,5-10,10-15,15c28,0,56,0,84,0c7.846,0,15.363-6.899,15-15c-0.364-8.127-6.591-15-15-15c-28,0-56,0-84,0c-8.114,0-14.993,6.872-15,15c-0.029,32.357-0.059,64.713-0.088,97.07c-0.047,51.486-0.093,102.971-0.14,154.457c-0.011,11.701-0.021,23.403-0.032,35.104c-0.007,8.109,6.878,15,15,15c28,0,56,0,84,0c8.114,0,14.993-6.873,15-15c0.029-32.357,0.059-64.713,0.088-97.07c0.047-51.486,0.093-102.971,0.14-154.457c0.011-11.701,0.021-23.402,0.032-35.104c0.007-7.846-6.904-15.363-15-15C778.042,611.025,771.183,617.252,771.175,625.661z"></path></svg>
                            &<Typography variant={'h6'} style={{color: 'grey', fontWeight: '500'}}>
                                ListingBuddy
                            </Typography>
                        </Button>

                        {!GlobalState.userIsLogged?(
                            <div style={{paddingTop: '10px'}}>
                                <Button color="inherit" onClick={() => navigate('/listing')} style={{color: 'black', fontSize: '12px'}}>Listing</Button>
                                <Button color="inherit" onClick={() => navigate('/agencies')} style={{color: 'black', fontSize: '12px'}}>Agencies</Button>
                                <Button color="inherit" onClick={() => navigate('/about')} style={{color: 'black', fontSize: '12px'}}>About us</Button>
                            </div>
                        ):(
                            <div style={{paddingTop: '10px'}}>
                                <Button color="inherit" onClick={() => navigate('/listing')} style={{color: 'black', fontSize: '12px'}}>Listing</Button>
                                <Button color="inherit" onClick={() => navigate('/agencies')} style={{color: 'black', fontSize: '12px'}}>Agencies</Button>
                                <Button color="inherit" onClick={() => navigate('/addproperty')} style={{color: 'black', fontSize: '12px'}}>Add Property</Button>
                            </div>

                            )
                        }
                        {!GlobalState.userIsLogged? (
                            <div style={{display:'flex', gap: '10px'}}>
                                <Button
                                    onClick={() => navigate('/login')}
                                    color={"inherit"}
                                    style={{
                                        backgroundColor: 'white',
                                        border: '1px solid black',
                                        color: 'black'
                                    }}
                                >Login</Button>
                                <Button
                                    onClick={() => navigate('/register')}
                                    color={"inherit"}
                                    style={{
                                        backgroundColor: 'black',
                                        color: 'white'
                                    }}
                                >Signup</Button>

                            </div>

                        ):(
                            <Button
                                onClick={handleClick}
                                color={"inherit"}
                                style={{
                                    backgroundColor: 'transparent',
                                    color: 'black',
                                    paddingTop: '10px'
                                }}
                            >{GlobalState.username} {isArrow? <ArrowDropUp/>: <ArrowDropDownIcon/>}</Button>
                        )}
                        <Menu
                            id="basic-menu"
                            anchorEl={anchorEl}
                            open={open}
                            onClose={handleClose}
                            MenuListProps={{'aria-labelledby': 'basic-button'}}
                        >
                            <MenuItem onClick={handleProfile}>Profile</MenuItem>
                            <MenuItem onClick={handleLogout}>Logout</MenuItem>
                        </Menu>
                        <Snackbar
                            open={openSnack}
                            message="You've Successfully Logged out!"
                            anchorOrigin={{
                                vertical: 'bottom',
                                horizontal: "center"
                            }}
                        />
                    </Toolbar>
                </AppBar>
            </Box>
        </>
    );
};

export default Header;